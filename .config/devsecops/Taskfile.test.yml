---
version: "3"

vars:
  TASK_DEVSECOPS_TEST_ENABLED: '{{.OVERRIDE_TASK_DEVSECOPS_TEST_ENABLED | default "true"}}'

tasks:
  default:
    desc: Run all tests tasks
    status:
      - test "{{.TASK_DEVSECOPS_TEST_ENABLED}}" = "false"
    cmds:
      - task: infrastructure

  tdd:
    desc: Run all tdd tests tasks
    status:
      - test "{{.TASK_DEVSECOPS_TEST_ENABLED}}" = "false"
    cmds:
      - task: infrastructure:tdd

  infrastructure:
    desc: Run all infrastructure tests tasks
    status:
      - test "{{.TASK_DEVSECOPS_TEST_ENABLED}}" = "false"
    cmds:
      - task: :test:infra:kube:dependency
      - task: :test:infra:kube:cleanup
      - task: :test:infra:kube:destroy
      - task: :test:infra:kube:syntax
      - task: :test:infra:kube:create
      - task: :test:infra:kube:prepare
      - task: :test:infra:kube:converge
      - task: :test:infra:kube:idempotence
      - task: :test:infra:kube:side_effect
      - task: :test:infra:kube:verify
      - task: :test:infra:kube:destroy
      - task: :test:infra:kube:cleanup

  infrastructure:tdd:
    desc: Run tdd infrastructure tests tasks
    status:
      - test "{{.TASK_DEVSECOPS_TEST_ENABLED}}" = "false"
    cmds:
      - task: :test:infra:kube:dependency
      - task: :test:infra:kube:syntax
      - task: :test:infra:kube:create
      - task: :test:infra:kube:prepare
      - task: :test:infra:kube:converge
      - task: :test:infra:kube:idempotence
      - task: :test:infra:kube:side_effect
      - task: :test:infra:kube:verify
