---
version: "3"

vars:
  TASK_LIZARD_ENABLED: '{{.TASK_LIZARD_ENABLED | default "true"}}'
  TASK_LIZARD_CLI_OPTS: '{{.TASK_LIZARD_CLI_OPTS | default ""}}'
  TASK_LIZARD_PATH_TO_ANALYSE: '{{.TASK_LIZARD_PATH_TO_ANALYSE | default "."}}'
  TASK_LIZARD_REQUIREMENTS_FILE: '{{.TASK_LIZARD_REQUIREMENTS_FILE | default ".config/lizard/requirements.txt"}}'
  TASK_LIZARD_PYTHON_VERSION_PATH: '{{.TASK_LIZARD_PYTHON_VERSION_PATH | default ".config/python/.python-version"}}'
  TASK_LIZARD_PYTHON_VERSION:
    sh: |
      if [ -n "${TASK_LIZARD_PYTHON_VERSION:-}" ]; then
        echo "${TASK_LIZARD_PYTHON_VERSION}"
      else
        cat {{.TASK_LIZARD_PYTHON_VERSION_PATH}}
      fi
  TASK_LIZARD_VERSION:
    sh: |
      if [ -n "${TASK_LIZARD_VERSION:-}" ]; then
        echo "${TASK_LIZARD_VERSION}"
      else
        cat {{.TASK_LIZARD_REQUIREMENTS_FILE}}
      fi
  TASK_LIZARD_COMMAND:
    sh: |
      if [ -n "${TASK_LIZARD_COMMAND:-}" ]; then
        echo "${TASK_LIZARD_COMMAND}"
      else
        echo "uvx --python {{.TASK_LIZARD_PYTHON_VERSION}} --from {{.TASK_LIZARD_VERSION}} lizard"
      fi

tasks:
  default:
    desc: Analyze code complexity with Lizard.
    summary: |
      ‚ÑπÔ∏è Description:
        Executes Lizard to analyse code complexity and maintainability.

      üîß Variables:
        - TASK_LIZARD_VERSION: Lizard version
        - TASK_LIZARD_CLI_OPTS: Command-line options for Lizard
        - TASK_LIZARD_PATH_TO_ANALYSE: Path to analyse

      üîÑ Execution:
        Runs Lizard with specified options on designated files

      üìù Note:
        Execute after code modifications to maintain quality standards
    status:
      - test "{{.TASK_LIZARD_ENABLED}}" = "false"
    cmds:
      - cmd: echo "üîÑ Starting lizard analysis phase"
        silent: true
      - |
        {{.TASK_LIZARD_COMMAND}} $(grep -v '^#' .gitignore | grep -v '^$' | awk '{if ($0 ~ /\./) print "-x"$0; else print "-x./"$0"/*"}' | tr '\n' ' ') {{.TASK_LIZARD_CLI_OPTS}} {{.TASK_LIZARD_PATH_TO_ANALYSE}}
      - cmd: echo "üéâ Lizard analysis phase completed successfully"
        silent: true
