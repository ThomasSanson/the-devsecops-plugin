---
release:
  stage: release
  needs: []  # Allows parallel execution
  extends: .default-tags
  variables:
    # Variables for Docker (likely used within 'task release')
    TASK_DOCKER_CE_AUTH_ENABLED: "true"
    TASK_DOCKER_CE_IMAGE_NAME: ${CI_REGISTRY_IMAGE}
    TASK_DOCKER_CE_PUSH: "true"
    TASK_DOCKER_CE_REGISTRY_PASSWORD: ${CI_REGISTRY_PASSWORD}
    TASK_DOCKER_CE_REGISTRY_URL: ${CI_REGISTRY}
    TASK_DOCKER_CE_REGISTRY_USERNAME: ${CI_REGISTRY_USER}
  script:
    - task release
  rules:
    - if: '$CI_PIPELINE_SOURCE == "schedule" && $RUN_ALL_SCHEDULE == "1"'
      when: always
    - if: '$CI_PIPELINE_SOURCE == "schedule" && $RUN_RELEASE_SCHEDULE == "1"'
      when: always
    - if: $CI_COMMIT_TAG =~ /^staging$/
      when: never
    # Run in all other cases (MRs, feature branches, etc.)
    - when: always

