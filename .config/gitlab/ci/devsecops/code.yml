---
code:
  stage: code
  retry: 1
  needs: [] # Allows parallel execution
  tags:
    - saas-linux-medium-amd64
  script:
    - task code
  rules:
    - if: '$CI_PIPELINE_SOURCE == "schedule" && $RUN_ALL_SCHEDULE == "1"'
      when: always
    - if: '$CI_PIPELINE_SOURCE == "schedule" && $RUN_CODE_SCHEDULE == "1"'
      when: always
    - if: $CI_COMMIT_TAG =~ /^staging$/
      when: never
    # Do not execute default jobs on the main branch
    - if: $CI_COMMIT_BRANCH == $CI_DEFAULT_BRANCH
      when: never
    # Run in all other cases (MRs, feature branches, etc.)
    - when: always
