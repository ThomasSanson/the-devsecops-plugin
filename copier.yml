---
# Template configuration
_answers_file: .config/devsecops/.copier-answers.yml
_skip_if_exists:
  - .config/devsecops/.copier-answers.yml
_min_copier_version: "9.4.0"

_exclude:
  - .cache
  - .config/**/roles
  - .git
  - .vscode
  - CHANGELOG.md
  - CONTRIBUTING.md
  - copier.yml
  - features/*
  - iac/environment/testing/superset-values.yaml
  - iac/helm/Chart.lock
  - LICENSE
  - megalinter-reports
  - node_modules
  - README.md
  - tests/copier
  - tests/devcontainer
  - tests/e2e/codeceptjs/output
  - tests/e2e/codeceptjs/screenshots/base/dashboard_after_login.png
  - tests/e2e/codeceptjs/step_definitions/authentication.js
  - tests/e2e/codeceptjs/step_definitions/copier.js
  - tests/infra/kube/ansible/verify/superset_is_ready.yml
  - tests/infra/kube/ansible/verify/superset_login_page_check.yml
  - tmp
  - venv
  - VERSION

_migrations:
  # Migration to remove obsolete files when updating to version 8.0.0
  - version: 8.0.0
    command: |
      # Remove obsolete files
      rm -f tests/infra/kube/cleanup.taskfile.yaml \
            tests/infra/kube/converge.taskfile.yaml \
            tests/infra/kube/create.taskfile.yaml \
            tests/infra/kube/dependency.taskfile.yaml \
            tests/infra/kube/destroy.taskfile.yaml \
            tests/infra/kube/idempotence.taskfile.yaml \
            tests/infra/kube/prepare.taskfile.yaml \
            tests/infra/kube/side_effect.taskfile.yaml \
            tests/infra/kube/syntax.taskfile.yaml \
            tests/infra/kube/verify.taskfile.yaml
      
      # Move requirements.yml if it exists in the old location
      if [ -f tests/infra/kube/requirements.yml ]; then
        mkdir -p tests/infra/kube/ansible
        mv -f tests/infra/kube/requirements.yml tests/infra/kube/ansible/requirements.yml
        echo "‚è© Moved requirements.yml to new location"
      fi
    when: "{{ _stage == 'before' }}"

_message_after_copy: |
  Your DevSecOps project has been created successfully!

  Next steps:
  1. Review the generated configuration files
  2. Install the required dependencies:
    $ task dev:setup-environment
  3. Start using the DevSecOps pipeline with:
    $ task
