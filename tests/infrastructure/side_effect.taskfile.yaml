---
version: "3"

vars:
  TASK_ANSIBLE_VIRTUALENV: '{{.OVERRIDE_TASK_ANSIBLE_VIRTUALENV | default "./venv/ansible"}}'

tasks:
  default:
    desc: |
      ‚ÑπÔ∏è Description:
        Simulates side effects to test system resilience in the following order:
        1. Executes Ansible playbooks that disrupt normal operation
        2. Waits for automatic recovery mechanisms to engage
    cmds:
      - cmd: echo "üöÄ Starting side effect simulation phase..."
        silent: true
      - task: ansible
      - cmd: echo "‚úÖ Side effect simulation phase completed."
        silent: true

  ansible:
    desc: |
      ‚ÑπÔ∏è Description:
        Executes infrastructure disruption playbooks

      üîß Variables:
        - TASK_ANSIBLE_VIRTUALENV: Path to Ansible virtual environment
    cmds:
      - |
        find tests/infrastructure/ansible/side_effects -type f \( -name "*.yml" -o -name "*.yaml" \) | while read playbook; do
          echo "‚ö†Ô∏è Executing side effect playbook: $playbook"
          {{.TASK_ANSIBLE_VIRTUALENV}}/bin/ansible-playbook "$playbook"
        done
