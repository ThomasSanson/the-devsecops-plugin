---
version: "3"

vars:
  TASK_ANSIBLE_VIRTUALENV: '{{.OVERRIDE_TASK_ANSIBLE_VIRTUALENV | default "./venv/ansible"}}'

tasks:
  default:
    desc: |
      ‚ÑπÔ∏è Description:
        Performs verification operations in the following order:
        1. Executes Ansible verification playbooks
    cmds:
      - cmd: echo "üöÄ Starting verification phase..."
        silent: true
      - task: ansible
      - cmd: echo "‚úÖ Verification phase completed successfully."
        silent: true

  ansible:
    desc: |
      ‚ÑπÔ∏è Description:
        Executes infrastructure verification playbooks

      üîß Variables:
        - TASK_ANSIBLE_VIRTUALENV: Path to Ansible virtual environment
    cmds:
      - |
        find tests/infrastructure/ansible/verify -type f \( -name "*.yml" -o -name "*.yaml" \) | while read playbook; do
          echo "üîé Executing verification playbook: $playbook"
          {{.TASK_ANSIBLE_VIRTUALENV}}/bin/ansible-playbook "$playbook"
        done
